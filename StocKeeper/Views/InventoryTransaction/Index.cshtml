@model IEnumerable<StocKeeper.Models.InventoryTransaction>

<div class="container mt-4">
    <h2>Inventory Transactions</h2>

    <!-- Search and Filter Panel -->
    <div class="card mb-3">
        <div class="card-body">
            @using (Html.BeginForm("Index", "InventoryTransaction", FormMethod.Get, new { @class = "row g-3" }))
            {
                <div class="col-md-3">
                    <div class="form-group">
                        <label>Search Reference/Product</label>
                        <input type="text" name="searchString" value="@ViewBag.CurrentSearch" class="form-control" placeholder="Search..." />
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label>Transaction Type</label>
                        <select name="transactionType" class="form-control">
                            <option value="">All Types</option>
                            <option value="IN">Stock In</option>
                            <option value="OUT">Stock Out</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label>Date From</label>
                        <input type="datetime-local" name="dateFrom" class="form-control" value="@ViewBag.DateFrom" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label>Date To</label>
                        <input type="datetime-local" name="dateTo" class="form-control" value="@ViewBag.DateTo" />
                    </div>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                    <a href="@Url.Action("Index")" class="btn btn-secondary">Clear Filters</a>
                    @Html.ActionLink("Record Transaction", "Create", null, new { @class = "btn btn-success float-end" })
                </div>
            }
        </div>
    </div>

    <!-- Transactions Table -->
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(model => model.TransactionDate)</th>
                    <th>@Html.DisplayNameFor(model => model.Product.Name)</th>
                    <th>@Html.DisplayNameFor(model => model.TransactionType)</th>
                    <th>@Html.DisplayNameFor(model => model.Quantity)</th>
                    <th>@Html.DisplayNameFor(model => model.ReferenceNumber)</th>
                    <th>@Html.DisplayNameFor(model => model.Reason)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr class="@(item.Product.CurrentStock <= item.Product.MinimumStockLevel ? "table-warning" : "")">
                        <td>@item.TransactionDate.ToString("MM-dd-yyyy HH:mm")</td>
                        <td>@item.Product.Name</td>
                        <td>
                            <span class="badge @(item.TransactionType == "IN" ? "bg-success" : "bg-danger")">
                                @item.TransactionType
                            </span>
                        </td>
                        <td>@item.Quantity</td>
                        <td>@item.ReferenceNumber</td>
                        <td>@item.Reason</td>
                        <td>
                            @if (item.Product.CurrentStock <= item.Product.MinimumStockLevel)
                            {
                                <span class="badge bg-warning"></span>
                            }
                            @Html.ActionLink("Details", "Details", new { id = item.TransactionId }, new { @class = "btn btn-sm btn-info" })
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
